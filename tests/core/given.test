#! /bin/sh
# -*- coding: utf-8 -*-
# Copyright (C) 2021, 2022 Laboratoire de Recherche et DÃ©veloppement de
# l'Epita (LRDE).
#
# This file is part of Spot, a model checking library.
#
# Spot is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# Spot is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
# License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

. ./defs || exit 1

set -e

ltl2tgba 'p | (!p & G(Fq & F!q & Fa))' >in
test '3 3' = "`autfilt in --stats='%s %a'`"
for i in restrict all; do
    test '2 3' = \
         "`autfilt --given-fo='F(Gq|G!q)' --given-s=$i in --stats='%s %a'`"
done
res=`autfilt --given-fo='F(Gq|G!q)' --given-s=rest in --small --stats='%s %a'`
test '2 0' = "$res"

ltl2tgba 'p | (!p & G(Fq & F!q & Fa))' >in
while read opt exp; do
    res=`autfilt --given-fo=Gp in --given-s=$opt --stats='%s %e %a'`
    test "$res" = "$exp"
done <<EOF
restrict 2 2 3
relax 3 7 3
all 2 2 3
EOF

while read opt exp; do
    res=`autfilt --given-fo=Gp in --given-s=$opt --small --stats='%s %e %x'`
    test "$res" = "$exp"
done <<EOF
restrict 1 1 1
relax 1 1 0
all 1 1 0
EOF

for opt in restrict relax all; do
    res=`ltl2tgba GFp | autfilt --given-s=$opt --given-fo='G!p' --stats=%s%e%x`
    test "$res" = 100
done

ltl2tgba 'F(!p0 | X!p1)' >in
while read opt exp; do
    res=`autfilt --given-fo='p0 & p1' in --given-s=$opt \
                 --small --stats='%s %e %x'`
    test "$res" = "$exp"
done <<EOF
restrict 3 4 2
relax 3 5 2
stutter 2 3 2
all 2 3 2
EOF


while read opt exp; do
    res=`autfilt --given-fo='p0' --given-fo='p1' \
         --given-s=$opt --small --stats='%s %e %x' in`
    test "$res" = "$exp"
done <<EOF
restrict 3 4 2
relax 3 5 2
stutter 2 3 2
all 3 4 2
EOF

while read opt exp; do
    res=`autfilt --given-fo='p0' --given-fo='p1' \
         --given-s=$opt --given-fixpoint --small --stats='%s %e %x' in`
    test "$res" = "$exp"
done <<EOF
restrict 3 4 2
relax 3 5 2
stutter 2 3 2
EOF
